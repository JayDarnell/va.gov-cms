<?php

/**
 * @file
 * Contains va_gov_facilities.module.
 */

use Drupal\Core\Entity\EntityForm;
use Drupal\Core\Form\FormStateInterface;
use Drupal\node\NodeInterface;

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */
function va_gov_facilities_form_node_form_alter(array &$form, FormStateInterface &$form_state) {
  _va_gov_facilities_hide_moreinfo_on_status_normal($form, $form_state);
}

/**
 * Hide more information field when facility status is normal.
 *
 * @param array $form
 *   The node form array.
 * @param Drupal\Core\Form\FormStateInterface $form_state
 *   The current form state.
 */
function _va_gov_facilities_hide_moreinfo_on_status_normal(array &$form, FormStateInterface &$form_state) {
  /** @var \Drupal\Core\Entity\EntityForm $form_object */
  $form_object = $form_state->getFormObject();
  if ($form_object instanceof EntityForm) {
    $entity = $form_object->getEntity();
    if (!$entity instanceof NodeInterface) {
      return;
    }

    /** @var \Drupal\node\NodeInterface $entity */
    $facilitiesWithStatus = [
      'health_care_local_facility',
      'nca_facility',
      'vba_facility',
      'vet_center',
      'vet_center_outstation',
    ];
    if (in_array($entity->bundle(), $facilitiesWithStatus)
    && ($entity->hasField('field_operating_status_facility'))
    && ($entity->hasField('field_operating_status_more_info'))) {
      // Hide status details field if status is set to normal.
      $form['field_operating_status_more_info']['#states'] = [
        'visible' => [
          ':input[name="field_operating_status_facility"]' => ['!value' => 'normal'],
        ],
      ];
    }
  }
}
